<window-config>
    <title>Tab Bar</title>
    <layout width="100%" height="32" x="0" y="38" />
    <behavior draggable="false" overlay="false" resizable="false" always-on-top="true" />
    <controls title="false" minimize="false" close="false" />
</window-config>

<style>
    #tab-bar.modular-window {
        transition: left 0.2s cubic-bezier(0.2, 0.8, 0.2, 1),
            width 0.2s cubic-bezier(0.2, 0.8, 0.2, 1);
        will-change: left, width;
    }

    .modular-window,
    .window-content {
        overflow: hidden !important;
        /* El scroll lo maneja el container interno */
        background-color: transparent !important;
        box-shadow: none !important;
    }

    .tab-bar-container {
        display: flex;
        align-items: flex-end;
        width: 100%;
        height: 100%;
        background-color: var(--bg-header);
        border-bottom: 1px solid var(--border-subtle);
        padding-left: 0;
        box-sizing: border-box;

        /* [SOLUCIÓN] Activar Scroll Horizontal */
        overflow-x: auto;
        overflow-y: hidden;
    }

    /* Estilo de Scrollbar fino (estilo IDE) */
    .tab-bar-container::-webkit-scrollbar {
        height: 3px;
        /* Muy fino */
        background: transparent;
    }

    .tab-bar-container::-webkit-scrollbar-thumb {
        background: var(--border-subtle);
        border-radius: 2px;
    }

    .tab-bar-container::-webkit-scrollbar-thumb:hover {
        background: var(--accent-color);
    }

    .tab-item {
        display: flex;
        align-items: center;
        height: 100%;
        padding: 0 12px;
        min-width: 120px;
        max-width: 200px;
        background-color: transparent;
        border-right: 1px solid var(--border-subtle);
        color: var(--text-muted);
        font-family: 'Segoe UI', sans-serif;
        font-size: 12px;
        cursor: pointer;
        user-select: none;
        position: relative;
        transition: background 0.1s;

        /* [SOLUCIÓN CRÍTICA] Evita que las pestañas se aplasten */
        flex-shrink: 0;
    }

    .tab-item:hover {
        background-color: var(--bg-hover);
        color: var(--text-main);
    }

    .tab-item.active {
        background-color: var(--bg-window);
        color: var(--accent-color);
        border-top: 2px solid var(--accent-color);
    }

    .tab-icon {
        font-size: 14px;
        margin-right: 6px;
        opacity: 0.7;
    }

    .tab-label {
        white-space: nowrap;
        overflow: hidden;
        text-overflow: ellipsis;
        flex: 1;
    }

    .tab-close {
        margin-left: 8px;
        width: 16px;
        height: 16px;
        border-radius: 3px;
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 10px;
        opacity: 0;
        transition: all 0.1s;
    }

    .tab-item:hover .tab-close {
        opacity: 0.7;
    }

    .tab-close:hover {
        background-color: #cc3333;
        color: white;
        opacity: 1;
    }
</style>

<div class="tab-bar-container" id="tabContainer">
</div>

<script>
    (function () {
        const container = document.getElementById('tabContainer');
        if (!container) return;

        // Habilitar scroll con rueda del ratón (Shift + Scroll vertical = Scroll horizontal)
        container.addEventListener('wheel', (e) => {
            if (e.deltaY !== 0) {
                // Si el usuario no pulsa Shift, convertimos el scroll vertical en horizontal
                // para mayor comodidad en la barra de pestañas
                if (Math.abs(e.deltaX) === 0) {
                    container.scrollLeft += e.deltaY;
                    e.preventDefault();
                }
            }
        }, { passive: false });

        container.addEventListener('click', (e) => {
            const tab = e.target.closest('.tab-item');
            if (tab) {
                if (e.target.closest('.tab-close')) {
                    e.stopPropagation();
                    // La lógica real de borrado está en tabbar.js, esto es solo visual/fallback
                    return;
                }
                container.querySelectorAll('.tab-item').forEach(t => t.classList.remove('active'));
                tab.classList.add('active');
            }
        });
    })();
</script>