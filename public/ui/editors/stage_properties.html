<window-config>
    <title>Properties</title>
    <layout width="300" height="600" minWidth="220" />
    <behavior draggable="true" overlay="false" resizable="true" />
    <controls minimize="true" close="true" />
</window-config>

<style>
    /* VARIABLES (Mismas de tu tema Dark) */
    .properties-root {
        --bg-window: #222222;
        --bg-header: #2d2d2d;
        --bg-input: #1e1e1e;
        --bg-hover: #353535;
        --text-main: #eeeeee;
        --text-muted: #aaaaaa;
        --icon-color: #ffffff;
        --border-subtle: #3a3a3a;
        --accent-color: #00a2ff;
        --font-family: 'Segoe UI', Tahoma, sans-serif;
        --font-size: 11px;
        --input-height: 24px;
    }

    .hidden {
        display: none !important;
    }

    .properties-container {
        display: flex;
        flex-direction: column;
        height: 100%;
        width: 100%;
        background-color: var(--bg-window);
        color: var(--text-main);
        font-family: var(--font-family);
        font-size: var(--font-size);
        overflow: hidden;
        user-select: none;
    }

    .prop-toolbar {
        padding: 6px;
        background-color: var(--bg-header);
        border-bottom: 1px solid var(--border-subtle);
        flex-shrink: 0;
    }

    .search-input {
        width: 100%;
        background-color: var(--bg-input);
        border: 1px solid #333;
        color: var(--text-main);
        padding: 4px 8px;
        border-radius: 4px;
        font-size: var(--font-size);
        outline: none;
        box-sizing: border-box;
    }

    .search-input:focus {
        border-color: var(--accent-color);
    }

    .prop-content {
        flex: 1;
        overflow-y: auto;
        overflow-x: hidden;
        padding-bottom: 20px;
    }

    .prop-content::-webkit-scrollbar {
        width: 8px;
        background: var(--bg-window);
    }

    .prop-content::-webkit-scrollbar-thumb {
        background: #444;
        border-radius: 4px;
        border: 2px solid var(--bg-window);
    }

    .prop-category {
        background-color: var(--bg-header);
        padding: 6px 8px;
        font-weight: 600;
        color: #fff;
        border-bottom: 1px solid var(--border-subtle);
        border-top: 1px solid var(--border-subtle);
        display: flex;
        align-items: center;
        cursor: pointer;
        margin-top: -1px;
        transition: background 0.1s;
    }

    .prop-category:hover {
        background-color: var(--bg-hover);
    }

    .prop-category .icon-arrow {
        font-size: 16px;
        margin-right: 4px;
        color: var(--icon-color);
        transition: transform 0.2s;
    }

    .prop-category.collapsed .icon-arrow {
        transform: rotate(-90deg);
    }

    .prop-category .icon-section {
        font-size: 14px;
        margin-right: 6px;
        color: var(--icon-color);
        opacity: 0.9;
    }

    .category-content {
        display: block;
    }

    .prop-row {
        display: flex;
        align-items: center;
        border-bottom: 1px solid #2a2a2a;
        min-height: 28px;
        padding: 2px 0;
        transition: background 0.1s;
    }

    .prop-row:hover {
        background-color: var(--bg-hover);
    }

    .prop-row[title] {
        cursor: help;
    }

    .prop-name {
        flex: 0 0 35%;
        min-width: 80px;
        max-width: 45%;
        padding-left: 10px;
        border-right: 1px solid #333;
        white-space: nowrap;
        overflow: hidden;
        text-overflow: ellipsis;
        color: #ddd;
    }

    .prop-value {
        flex: 1;
        padding: 0 6px;
        display: flex;
        align-items: center;
        gap: 6px;
        overflow: hidden;
    }

    .prop-input {
        flex: 1;
        min-width: 0;
        height: var(--input-height);
        background-color: transparent;
        border: 1px solid transparent;
        color: var(--text-main);
        padding: 0 6px;
        font-family: monospace;
        font-size: var(--font-size);
        border-radius: 3px;
        transition: all 0.1s;
    }

    .prop-input:hover {
        background-color: var(--bg-input);
        border-color: #3a3a3a;
    }

    .prop-input:focus {
        background-color: var(--bg-input);
        border-color: var(--accent-color);
        outline: none;
    }

    select.prop-input {
        cursor: pointer;
        font-family: 'Segoe UI', sans-serif;
    }

    .multi-group {
        display: flex;
        flex: 1;
        align-items: center;
        gap: 4px;
        min-width: 0;
    }

    .label-mini {
        color: var(--text-muted);
        background-color: var(--bg-input);
        border: 1px solid var(--border-subtle);
        border-radius: 2px;
        font-size: 9px;
        width: 14px;
        height: 14px;
        display: flex;
        align-items: center;
        justify-content: center;
        font-weight: bold;
        user-select: none;
    }

    .checkbox-wrapper {
        display: flex;
        align-items: center;
        cursor: pointer;
        font-size: var(--font-size);
        color: #ccc;
        overflow: hidden;
        white-space: nowrap;
    }

    .checkbox-wrapper input {
        opacity: 0;
        position: absolute;
        width: 0;
        height: 0;
    }

    .checkmark {
        flex-shrink: 0;
        height: 14px;
        width: 14px;
        background-color: var(--bg-input);
        border: 1px solid #444;
        border-radius: 3px;
        display: flex;
        align-items: center;
        justify-content: center;
        margin-right: 6px;
    }

    .checkbox-wrapper:hover .checkmark {
        border-color: #888;
    }

    .checkbox-wrapper input:checked~.checkmark {
        background-color: var(--accent-color);
        border-color: var(--accent-color);
    }

    .checkmark:after {
        content: "";
        display: none;
        width: 3px;
        height: 7px;
        border: solid white;
        border-width: 0 2px 2px 0;
        transform: rotate(45deg) translateY(-1px);
    }

    .checkbox-wrapper input:checked~.checkmark:after {
        display: block;
    }

    .slider-wrapper {
        flex: 1;
        display: flex;
        align-items: center;
        gap: 8px;
        min-width: 0;
    }

    input[type=range] {
        -webkit-appearance: none;
        width: 100%;
        background: transparent;
        height: 20px;
        cursor: pointer;
        margin: 0;
    }

    input[type=range]:focus {
        outline: none;
    }

    input[type=range]::-webkit-slider-runnable-track {
        width: 100%;
        height: 4px;
        background: var(--bg-input);
        border: 1px solid #333;
        border-radius: 2px;
    }

    input[type=range]::-webkit-slider-thumb {
        height: 12px;
        width: 12px;
        border-radius: 50%;
        background: #888;
        margin-top: -5px;
        -webkit-appearance: none;
    }

    input[type=range]:hover::-webkit-slider-thumb {
        background: #fff;
        transform: scale(1.1);
    }

    input[type=range]:active::-webkit-slider-thumb {
        background: var(--accent-color);
    }

    .slider-val {
        font-family: monospace;
        font-size: 10px;
        min-width: 28px;
        text-align: right;
        color: #ccc;
    }

    .color-wrapper {
        display: flex;
        align-items: center;
        width: 100%;
        gap: 6px;
    }

    .color-preview {
        width: 100%;
        max-width: 40px;
        height: 20px;
        border: 1px solid #444;
        border-radius: 3px;
        cursor: pointer;
        flex-shrink: 0;
    }

    .empty-state {
        display: flex;
        flex-direction: column;
        justify-content: center;
        align-items: center;
        height: 100%;
        color: var(--text-muted);
        text-align: center;
        padding: 20px;
        opacity: 0.5;
    }

    .empty-state .material-icons {
        font-size: 48px;
        margin-bottom: 10px;
        color: #fff;
        opacity: 0.2;
    }
</style>

<div class="properties-root" style="height: 100%;">
    <div class="properties-container">

        <div class="prop-toolbar">
            <input type="text" id="propSearch" class="search-input" placeholder="Filter properties...">
        </div>

        <div class="empty-state" id="propEmpty">
            <span class="material-icons">tune</span>
            <div>No selection</div>
        </div>

        <div class="prop-content hidden" id="propContent">

            <div id="view-character" class="hidden view-section">
                <div class="prop-category"><span class="material-icons icon-arrow">arrow_drop_down</span><span
                        class="material-icons icon-section">description</span>Data</div>
                <div class="category-content">
                    <div class="prop-row" title="Character type (BF, Dad, GF).">
                        <div class="prop-name">Type</div>
                        <div class="prop-value"><select class="prop-input" id="char-select">
                                <option value="bf">Boyfriend</option>
                                <option value="dad">Opponent</option>
                                <option value="gf">Girlfriend</option>
                            </select></div>
                    </div>
                </div>

                <div class="prop-category"><span class="material-icons icon-arrow">arrow_drop_down</span><span
                        class="material-icons icon-section">transform</span>Transform</div>
                <div class="category-content">
                    <div class="prop-row" title="Position (X, Y).">
                        <div class="prop-name">Position</div>
                        <div class="prop-value">
                            <div class="multi-group"><span class="label-mini">X</span><input type="number"
                                    class="prop-input" id="char-x" step="1"></div>
                            <div class="multi-group"><span class="label-mini">Y</span><input type="number"
                                    class="prop-input" id="char-y" step="1"></div>
                        </div>
                    </div>
                    <div class="prop-row" title="Scale.">
                        <div class="prop-name">Scale</div>
                        <div class="prop-value">
                            <div class="multi-group"><span class="label-mini">X</span><input type="number"
                                    class="prop-input" id="char-scale-x" step="0.05"></div>
                            <div class="multi-group"><span class="label-mini">Y</span><input type="number"
                                    class="prop-input" id="char-scale-y" step="0.05"></div>
                        </div>
                    </div>
                    <div class="prop-row">
                        <div class="prop-name">Rotation</div>
                        <div class="prop-value"><input type="number" class="prop-input" id="char-angle" step="1"></div>
                    </div>
                    <div class="prop-row">
                        <div class="prop-name">Layer</div>
                        <div class="prop-value"><input type="number" class="prop-input" id="char-depth" step="1"></div>
                    </div>
                    <div class="prop-row" title="Parallax Scroll (1,1 moves with camera).">
                        <div class="prop-name">Scroll</div>
                        <div class="prop-value">
                            <div class="multi-group"><span class="label-mini">X</span><input type="number"
                                    class="prop-input" id="char-scroll-x" step="0.1"></div>
                            <div class="multi-group"><span class="label-mini">Y</span><input type="number"
                                    class="prop-input" id="char-scroll-y" step="0.1"></div>
                        </div>
                    </div>
                </div>

                <div class="prop-category"><span class="material-icons icon-arrow">arrow_drop_down</span><span
                        class="material-icons icon-section">visibility</span>Visuals</div>
                <div class="category-content">
                    <div class="prop-row">
                        <div class="prop-name">Opacity</div>
                        <div class="prop-value">
                            <div class="slider-wrapper"><input type="range" id="char-alpha" min="0" max="1"
                                    step="0.01"><span class="slider-val" id="char-alpha-val">1.0</span></div>
                        </div>
                    </div>
                    <div class="prop-row">
                        <div class="prop-name">Flip</div>
                        <div class="prop-value" style="justify-content: space-between;"><label
                                class="checkbox-wrapper"><input type="checkbox" id="char-flip-x"><span
                                    class="checkmark"></span> X</label><label class="checkbox-wrapper"><input
                                    type="checkbox" id="char-flip-y"><span class="checkmark"></span> Y</label></div>
                    </div>
                </div>

                <div class="prop-category"><span class="material-icons icon-arrow">arrow_drop_down</span><span
                        class="material-icons icon-section">videocam</span>Camera</div>
                <div class="category-content">
                    <div class="prop-row">
                        <div class="prop-name">Offset</div>
                        <div class="prop-value">
                            <div class="multi-group"><span class="label-mini">X</span><input type="number"
                                    class="prop-input" id="char-cam-x" step="5"></div>
                            <div class="multi-group"><span class="label-mini">Y</span><input type="number"
                                    class="prop-input" id="char-cam-y" step="5"></div>
                        </div>
                    </div>
                </div>
            </div>

            <div id="view-generic" class="hidden view-section">
                <div class="prop-category"><span class="material-icons icon-arrow">arrow_drop_down</span><span
                        class="material-icons icon-section">description</span>General</div>
                <div class="category-content">
                    <div class="prop-row">
                        <div class="prop-name">Name</div>
                        <div class="prop-value"><input type="text" class="prop-input" id="prop-name"></div>
                    </div>
                </div>

                <div class="prop-category"><span class="material-icons icon-arrow">arrow_drop_down</span><span
                        class="material-icons icon-section">transform</span>Transform</div>
                <div class="category-content">
                    <div class="prop-row">
                        <div class="prop-name">Position</div>
                        <div class="prop-value">
                            <div class="multi-group"><span class="label-mini">X</span><input type="number"
                                    class="prop-input" id="prop-x" step="1"></div>
                            <div class="multi-group"><span class="label-mini">Y</span><input type="number"
                                    class="prop-input" id="prop-y" step="1"></div>
                        </div>
                    </div>
                    <div class="prop-row">
                        <div class="prop-name">Scale</div>
                        <div class="prop-value">
                            <div class="multi-group"><span class="label-mini">X</span><input type="number"
                                    class="prop-input" id="prop-scale-x" step="0.1"></div>
                            <div class="multi-group"><span class="label-mini">Y</span><input type="number"
                                    class="prop-input" id="prop-scale-y" step="0.1"></div>
                        </div>
                    </div>

                    <div class="prop-row" title="Parallax Scroll Factor.">
                        <div class="prop-name">Scroll</div>
                        <div class="prop-value">
                            <div class="multi-group"><span class="label-mini">X</span><input type="number"
                                    class="prop-input" id="prop-scroll-x" step="0.1"></div>
                            <div class="multi-group"><span class="label-mini">Y</span><input type="number"
                                    class="prop-input" id="prop-scroll-y" step="0.1"></div>
                        </div>
                    </div>
                </div>

                <div class="prop-category"><span class="material-icons icon-arrow">arrow_drop_down</span><span
                        class="material-icons icon-section">palette</span>Visuals</div>
                <div class="category-content">
                    <div class="prop-row">
                        <div class="prop-name">Visible</div>
                        <div class="prop-value"><label class="checkbox-wrapper"><input type="checkbox"
                                    id="prop-visible"><span class="checkmark"></span> Enabled</label></div>
                    </div>
                    <div class="prop-row">
                        <div class="prop-name">Alpha</div>
                        <div class="prop-value"><input type="number" class="prop-input" id="prop-alpha" step="0.1"
                                max="1" min="0"></div>
                    </div>
                    <div class="prop-row">
                        <div class="prop-name">Color</div>
                        <div class="prop-value">
                            <div class="color-wrapper">
                                <div class="color-preview" id="prop-color-preview" style="background:#fff"></div><input
                                    type="text" class="prop-input" id="prop-color-hex" value="#FFFFFF">
                            </div>
                        </div>
                    </div>
                </div>
            </div>

        </div>
    </div>
</div>

<script>
    (function () {
        // Lógica de colapso y búsqueda
        const categories = document.querySelectorAll('.prop-category');
        const searchInput = document.getElementById('propSearch');
        const views = document.querySelectorAll('.view-section');

        categories.forEach(cat => {
            cat.addEventListener('click', () => {
                if (searchInput.value.trim() !== "") return;
                cat.classList.toggle('collapsed');
                const content = cat.nextElementSibling;
                if (content && content.classList.contains('category-content')) {
                    if (cat.classList.contains('collapsed')) content.classList.add('hidden');
                    else content.classList.remove('hidden');
                }
            });
        });

        searchInput.addEventListener('input', (e) => {
            const term = e.target.value.toLowerCase().trim();
            const isSearching = term.length > 0;

            views.forEach(view => {
                if (view.classList.contains('hidden')) return;
                const cats = view.querySelectorAll('.prop-category');

                cats.forEach(cat => {
                    const content = cat.nextElementSibling;
                    const rows = content.querySelectorAll('.prop-row');
                    let hasVisibleRow = false;

                    rows.forEach(row => {
                        const nameDiv = row.querySelector('.prop-name');
                        if (!nameDiv) return;
                        if (isSearching) {
                            if (nameDiv.textContent.toLowerCase().includes(term)) {
                                row.classList.remove('hidden');
                                hasVisibleRow = true;
                            } else {
                                row.classList.add('hidden');
                            }
                        } else {
                            row.classList.remove('hidden');
                            hasVisibleRow = true;
                        }
                    });

                    if (isSearching) {
                        if (hasVisibleRow) {
                            cat.classList.remove('hidden');
                            content.classList.remove('hidden');
                            cat.classList.remove('collapsed');
                        } else {
                            cat.classList.add('hidden');
                            content.classList.add('hidden');
                        }
                    } else {
                        cat.classList.remove('hidden');
                        cat.classList.remove('collapsed');
                        content.classList.remove('hidden');
                    }
                });
            });
        });
    })();
</script>